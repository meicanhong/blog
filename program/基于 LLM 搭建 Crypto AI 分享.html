<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于 LLM 搭建 Crypto AI 分享 | Danny Blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="看见 思考 行动">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f2fa720d.css" as="style"><link rel="preload" href="/blog/assets/js/app.b3cd8b9c.js" as="script"><link rel="preload" href="/blog/assets/js/3.e48b3d94.js" as="script"><link rel="preload" href="/blog/assets/js/1.b21f7e85.js" as="script"><link rel="preload" href="/blog/assets/js/20.f734a26d.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.9d4b6410.js"><link rel="prefetch" href="/blog/assets/js/11.1e7037fa.js"><link rel="prefetch" href="/blog/assets/js/12.29080457.js"><link rel="prefetch" href="/blog/assets/js/13.50e2ab1b.js"><link rel="prefetch" href="/blog/assets/js/14.56f69b1b.js"><link rel="prefetch" href="/blog/assets/js/15.78cd76ed.js"><link rel="prefetch" href="/blog/assets/js/16.36b1c6b3.js"><link rel="prefetch" href="/blog/assets/js/17.b88e47d8.js"><link rel="prefetch" href="/blog/assets/js/18.927af808.js"><link rel="prefetch" href="/blog/assets/js/19.78dece3c.js"><link rel="prefetch" href="/blog/assets/js/21.fdc51251.js"><link rel="prefetch" href="/blog/assets/js/22.6d0faa43.js"><link rel="prefetch" href="/blog/assets/js/23.43716d62.js"><link rel="prefetch" href="/blog/assets/js/24.45c0b937.js"><link rel="prefetch" href="/blog/assets/js/25.6de534bf.js"><link rel="prefetch" href="/blog/assets/js/26.e610d5b5.js"><link rel="prefetch" href="/blog/assets/js/27.7b1bda7b.js"><link rel="prefetch" href="/blog/assets/js/28.77838af3.js"><link rel="prefetch" href="/blog/assets/js/29.ecacd79b.js"><link rel="prefetch" href="/blog/assets/js/30.63c813a1.js"><link rel="prefetch" href="/blog/assets/js/31.bd2afa2a.js"><link rel="prefetch" href="/blog/assets/js/32.e96d82c6.js"><link rel="prefetch" href="/blog/assets/js/33.51899a87.js"><link rel="prefetch" href="/blog/assets/js/34.e771f0ea.js"><link rel="prefetch" href="/blog/assets/js/35.bee5e3ef.js"><link rel="prefetch" href="/blog/assets/js/36.fe6dd152.js"><link rel="prefetch" href="/blog/assets/js/37.dd849755.js"><link rel="prefetch" href="/blog/assets/js/38.49fbe78f.js"><link rel="prefetch" href="/blog/assets/js/39.d650b590.js"><link rel="prefetch" href="/blog/assets/js/4.00cdaea1.js"><link rel="prefetch" href="/blog/assets/js/40.476549ca.js"><link rel="prefetch" href="/blog/assets/js/41.3f198030.js"><link rel="prefetch" href="/blog/assets/js/5.73ad375f.js"><link rel="prefetch" href="/blog/assets/js/6.9b488c42.js"><link rel="prefetch" href="/blog/assets/js/7.5b330bb0.js"><link rel="prefetch" href="/blog/assets/js/8.89457084.js"><link rel="prefetch" href="/blog/assets/js/9.d1919d85.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f2fa720d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Danny Blog</h3> <p class="description" data-v-59e6cb88>看见 思考 行动</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Danny</span>
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Danny Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/Big-Data/" class="nav-link"><i class="undefined"></i>
  Big-Data
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Life/" class="nav-link"><i class="undefined"></i>
  Life
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Philosophy/" class="nav-link"><i class="undefined"></i>
  Philosophy
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Program/" class="nav-link"><i class="undefined"></i>
  Program
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="https://meicanhong.github.io/blog/categories/Philosophy/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-date"></i>
  Philosophy
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/blog/mythink/about_me.html" class="nav-link"><i class="undefined"></i>
  About Me
</a></div><div class="nav-item"><a href="http://117.50.185.73/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  My GPT
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/meicanhong" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/blog/avatar.jpg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    Danny
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>29</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>15</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/Big-Data/" class="nav-link"><i class="undefined"></i>
  Big-Data
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Life/" class="nav-link"><i class="undefined"></i>
  Life
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Philosophy/" class="nav-link"><i class="undefined"></i>
  Philosophy
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Program/" class="nav-link"><i class="undefined"></i>
  Program
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="https://meicanhong.github.io/blog/categories/Philosophy/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-date"></i>
  Philosophy
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/blog/mythink/about_me.html" class="nav-link"><i class="undefined"></i>
  About Me
</a></div><div class="nav-item"><a href="http://117.50.185.73/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  My GPT
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/meicanhong" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>基于 LLM 搭建 Crypto AI 分享</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Danny</span>
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">基于 LLM 搭建 Crypto AI 分享</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>Danny</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2023/9/29</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>LLM</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="基于-llm-搭建-crypto-ai-分享"><a href="#基于-llm-搭建-crypto-ai-分享" class="header-anchor">#</a> 基于 LLM 搭建 Crypto AI 分享</h1> <p>项目在线地址：<a href="https://ai.footprint.network/" target="_blank" rel="noopener noreferrer">https://ai.footprint.network/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="项目背景"><a href="#项目背景" class="header-anchor">#</a> 项目背景</h2> <p>公司最近要开发一款 Crypto 领域的 AI Bot 应用，可以回答用户 crypto 领域的问题。要做到以下功能：</p> <ol><li>bot 是 crypto 领域的专家，它可以回答任何关于 crypto 的问题</li> <li>bot 的回答是基于实时数据生成的，它可以告诉你最近 crypto 的新闻</li> <li>bot 进行数据分析，例如你可以问 bot opensea 最近 7 天的 top10 交互用户是谁，bot 会将数据转化成 BI 报表返回，并给予数据分析的文本</li></ol> <h2 id="技术组件"><a href="#技术组件" class="header-anchor">#</a> 技术组件</h2> <ul><li>chainlit 客户端</li> <li>chatglm2-6b LLM 模型，基于此模型 fine tune crypto knowledge</li> <li>chatgpt3.5</li> <li>qdrant 向量数据库</li> <li>sentence-transformers/all-MiniLM-L6-v2 embedding model</li> <li>mongo 存新闻数据</li></ul> <h2 id="流程图"><a href="#流程图" class="header-anchor">#</a> 流程图</h2> <p><img src="/blog/assets/img/img_13.6dd2f5dd.png" alt="Untitled"></p> <h3 id="问题改写"><a href="#问题改写" class="header-anchor">#</a> 问题改写</h3> <p>用户的问题不一定是自然语言，可能有语法问题。我们可以借用 LLM 模型优化用户的问题，使其语义更清晰标准。</p> <h3 id="命名实体识别"><a href="#命名实体识别" class="header-anchor">#</a> 命名实体识别</h3> <p>识别用户问题中的关键词，得到关键词后可利用关键词为 vector db 元数据过滤使用，可以获取更精确的数据上下文。</p> <h3 id="问题分类"><a href="#问题分类" class="header-anchor">#</a> 问题分类</h3> <p>分析用户的问题主题，根据主题路由到系统中不同组件。</p> <p>编写一段问题分类的 Prompt，然后丢给 LLM 得到分类 ID。</p> <p>需要设计好该 bot 会接收到问题类别，然后按以下格式预备好：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
				<span class="token property">&quot;Tool ID&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Tool Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Crypto News and Articles&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Tool Description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A collection of crypto news and articles from top sources, covering the latest industry developments, trends, and research. This tool is a valuable resource for anyone who wants to stay up-to-date on the latest happenings in the crypto world.&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
				<span class="token property">&quot;Tool ID&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Tool Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CryptoWiki&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Tool Description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A crypto-native wiki that provides comprehensive and up-to-date information on all aspects of the crypto industry, including blockchain technology, cryptocurrencies, DeFi, NFTs, and the metaverse. CryptoWiki is written by experts in the field and is regularly updated to reflect the latest developments.&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
				<span class="token property">&quot;Tool ID&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Tool Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Cryptocurrency Price Technical Analysis Tool&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Tool Description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This tool is specifically designed to automatically fetch cryptocurrency price information, calculate indicators, analyze cryptocurrency market trends based on this data, and generate technical analysis reports. DO NOT use this tool to obtain concepts or definitions. This tool is only suitable for independent analysis that relies solely on prices and indicators. DO NOT use this tool when analyzing prices requires incorporating current news.&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
				<span class="token property">&quot;Tool ID&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Tool Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Footprint Analytics&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Tool Description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A powerful web-based platform for querying and analyzing public blockchain data. Footprint provides a variety of tools and resources to help users make sense of complex blockchain data, including a powerful SQL query engine, a library of pre-built dashboards and reports, and a community of experienced analysts and developers. Footprint Analytics can be used for a variety of purposes, including investment research, market analysis, product development, and academic research.DO NOT use this tool when analyzing prices requires incorporating current news and Cryptocurrency Price Technical Analysis.&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>问题分类 Prompt 参考：</p> <div class="language-python extra-class"><pre class="language-python"><code>DEFAULT_DISPATCHING_PROMPT <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;You are an intelligent robot commander, and you can choose one of the given tools to enable the assistants to serve the users and fulfill their requests. Here are the IDs, names, and descriptions of the tools.

Make sure your output follows the JSON format without any other words:

{{
    &quot;tool_id&quot;: ...(int)
    &quot;reason&quot;: ...(string)
}}

Examples:

### Tools

Tool ID: 0
Tool Name: Caculator
Tool Description: A calculator is a device capable of performing mathematical operations and computations.

Tool ID: 1
Tool Name: Google Search
Tool Description: A powerful tool that provides users with the ability to find and access information from the vast amount of content available on the internet.

### Chat histories
(Not given)

### Question
1 + 1 = ?

Output:
{{
    &quot;tool_id&quot;: 0,
    &quot;reason&quot;: &quot;The calculator can solve the given arithmetic problem.&quot;
}}

Now, you are given the below tools, the history of conversations between the users and the assistants and a following up question:

### Tools
{tools}

### Chat histories
{chat_history}

### Question
{question}

Which of the mentioned tools do you believe is the most suitable and likely to help solve the user's problem? If you believe that none of the tools are suitable, please output -1.

Output:&quot;&quot;&quot;</span>
</code></pre></div><h3 id="sql"><a href="#sql" class="header-anchor">#</a> SQL</h3> <p>若用户的问题是需要进行数据分析的，会路由到我们的 SQL 组件。该组件主要是根据用户的问题生成对应的SQL，运行 SQL 获取结果，将结果转成 BI 报表。</p> <h3 id="news"><a href="#news" class="header-anchor">#</a> News</h3> <p>我们需要先将新闻获取下来存到传统 DB 里，然后将新闻文本按照一定格式进行切割，将格式化切割好的数据进行向量化处理，然后存入 vector db</p> <p>新闻文章结构参考：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;bigint&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;varchar&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;subtype&quot;</span><span class="token operator">:</span><span class="token string">&quot;varchar&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;created_at&quot;</span><span class="token operator">:</span><span class="token string">&quot;timestamp(3)&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;website&quot;</span><span class="token operator">:</span><span class="token string">&quot;varchar&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;website_url&quot;</span><span class="token operator">:</span><span class="token string">&quot;varchar&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;headline&quot;</span><span class="token operator">:</span><span class="token string">&quot;varchar&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;subheadline&quot;</span><span class="token operator">:</span><span class="token string">&quot;varchar&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span><span class="token string">&quot;varchar&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;contents&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text/quote/image/head&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span><span class="token string">&quot;varchar&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在此结构上，我们将 headline + subheadline + content 内容进行 embedding，将 type + subtype + created_at + website 作为 metadata，将上述数据存入 vector db。metadata 是为了我们能够更精确的检索数据，例如我想查看最近一周发生了什么事情，可以过滤 created_at 是最近一周的数据出来</p> <p>有了以上的数据准备，当用户的问题过来时，我们需要将问题 embedding 后进入 vectordb 进行搜索，找到相似的文本并进行筛选过滤，就可以找到对应的新闻事件了</p> <p>这里有意思的是，我们可以通过命名实体识别获取到一些实体信息，例如问题是：最近7天opensea发生了什么事情？这里可以识别到最近7天这个实体信息；我们最近7天这个信息作为 metadata filter 过滤，便能更准确找到新闻数据。</p> <p>我们将获取到的新闻数据作为上下文参考，和用户的问题一起丢给 LLM，便可以得到比较准确的回答。</p> <p>Prompt参考：</p> <div class="language-python extra-class"><pre class="language-python"><code>DEFAULT_VQA_PROMPT <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;Use the following pieces of context to answer the question at the end. If the context is not relevant or not given, kindly apologize and say that you do not know and stop speaking. Unless specifically requested, please try to use concise language in your responses. Don't mention you are provided with context to answer the question.

Context: {context}
Question: {query}

You should reply in the same language as the &quot;Question&quot;.
Your response:
&quot;&quot;&quot;</span>
</code></pre></div></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/blog/program/%E5%9F%BA%E4%BA%8E%20LLM%20%E6%90%AD%E5%BB%BA%20Crypto%20AI%20%E5%88%86%E4%BA%AB.html#项目背景" class="sidebar-link reco-side-项目背景" data-v-b57cc07c>项目背景</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/program/%E5%9F%BA%E4%BA%8E%20LLM%20%E6%90%AD%E5%BB%BA%20Crypto%20AI%20%E5%88%86%E4%BA%AB.html#技术组件" class="sidebar-link reco-side-技术组件" data-v-b57cc07c>技术组件</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/program/%E5%9F%BA%E4%BA%8E%20LLM%20%E6%90%AD%E5%BB%BA%20Crypto%20AI%20%E5%88%86%E4%BA%AB.html#流程图" class="sidebar-link reco-side-流程图" data-v-b57cc07c>流程图</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/program/%E5%9F%BA%E4%BA%8E%20LLM%20%E6%90%AD%E5%BB%BA%20Crypto%20AI%20%E5%88%86%E4%BA%AB.html#问题改写" class="sidebar-link reco-side-问题改写" data-v-b57cc07c>问题改写</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/program/%E5%9F%BA%E4%BA%8E%20LLM%20%E6%90%AD%E5%BB%BA%20Crypto%20AI%20%E5%88%86%E4%BA%AB.html#命名实体识别" class="sidebar-link reco-side-命名实体识别" data-v-b57cc07c>命名实体识别</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/program/%E5%9F%BA%E4%BA%8E%20LLM%20%E6%90%AD%E5%BB%BA%20Crypto%20AI%20%E5%88%86%E4%BA%AB.html#问题分类" class="sidebar-link reco-side-问题分类" data-v-b57cc07c>问题分类</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/program/%E5%9F%BA%E4%BA%8E%20LLM%20%E6%90%AD%E5%BB%BA%20Crypto%20AI%20%E5%88%86%E4%BA%AB.html#sql" class="sidebar-link reco-side-sql" data-v-b57cc07c>SQL</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/program/%E5%9F%BA%E4%BA%8E%20LLM%20%E6%90%AD%E5%BB%BA%20Crypto%20AI%20%E5%88%86%E4%BA%AB.html#news" class="sidebar-link reco-side-news" data-v-b57cc07c>News</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/blog/assets/js/app.b3cd8b9c.js" defer></script><script src="/blog/assets/js/3.e48b3d94.js" defer></script><script src="/blog/assets/js/1.b21f7e85.js" defer></script><script src="/blog/assets/js/20.f734a26d.js" defer></script>
  </body>
</html>
